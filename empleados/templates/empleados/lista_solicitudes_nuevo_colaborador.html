<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Solicitudes de Nuevo Colaborador</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
  <style>
    body{background:linear-gradient(135deg,#f5f7fa 0%, #c3cfe2 100%);min-height:100vh}
    .page-wrapper{max-width:1100px;margin:32px auto;padding:0 16px}
    .card-ui{background:#fff;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,.08);overflow:hidden;border:1px solid #e2e8f0}
    .card-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}
    .card-header h2{margin:0;font-size:1.25rem}
    .table thead th{color:#4a5568;text-transform:uppercase;font-size:.85rem;letter-spacing:.5px}
    .estado-badge{border-radius:999px;padding:4px 10px;font-size:.75rem}
    .estado-pendiente{background:#fff3cd;color:#856404}
    .estado-aprobado{background:#d4edda;color:#155724}
    .estado-rechazado{background:#f8d7da;color:#721c24}
  </style>
</head>
<body>
<div class="page-wrapper">
  <div class="card-ui">
    <div class="card-header">
      <h2>Solicitudes de Nuevo Colaborador</h2>
      <a href="{% url 'nueva_solicitud_nuevo_colaborador' %}" class="btn btn-sm btn-light">Nueva solicitud</a>
    </div>
    <div class="p-3">
      <!-- Mensajes de Procesamiento -->
      {% if mensaje_procesamiento %}
      <div class="alert alert-{{ tipo_mensaje|default:'success' }} d-flex align-items-center mb-3" role="alert">
        {% if tipo_mensaje == 'warning' %}
        <i class="fas fa-exclamation-triangle me-2"></i>
        {% elif tipo_mensaje == 'info' %}
        <i class="fas fa-info-circle me-2"></i>
        {% else %}
        <i class="fas fa-check-circle me-2"></i>
        {% endif %}
        <strong>{{ mensaje_procesamiento }}</strong>
      </div>
      {% endif %}
      
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">Total de solicitudes: {{ solicitudes|length }}</h5>
        <a href="{% url 'manager_dashboard' %}" class="btn btn-outline-primary">Regresar al Dashboard</a>
      </div>
  <table class="table table-hover align-middle">
    <thead>
      <tr>
        <th>Área</th>
        <th>DNI Colaborador</th>
        <th>Puesto</th>
        <th>Grupo</th>
        <th>Inicio</th>
        <th>Estado</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for s in solicitudes %}
      <tr>
        <td>{{ s.area_solicitante }}</td>
        <td><span class="badge bg-secondary">{{ s.dni_colaborador|default:"Sin DNI" }}</span></td>
        <td>{{ s.puesto_a_solicitud }}</td>
        <td>{{ s.get_grupo_ocupacional_display }}</td>
        <td>{{ s.fecha_inicio_labores }}</td>
        <td>
          <span class="estado-badge 
            {% if s.estado == 'pendiente' %}estado-pendiente{% elif s.estado == 'aprobado' %}estado-aprobado{% else %}estado-rechazado{% endif %}">
            {{ s.get_estado_display }}
          </span>
        </td>
        <td>
          {% if empleado.es_empleado_rrhh %}
          <a class="btn btn-sm btn-outline-primary" href="{% url 'procesar_solicitud_nuevo_colaborador_rrhh' s.id %}">Procesar</a>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="7" class="text-center text-muted py-4">No hay solicitudes.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
</div>
</div>

<script>
  // Auto-ocultar mensajes de procesamiento después de 5 segundos
  document.addEventListener('DOMContentLoaded', function() {
    const alertMessage = document.querySelector('.alert');
    if (alertMessage) {
      setTimeout(() => {
        alertMessage.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
        alertMessage.style.opacity = '0';
        alertMessage.style.transform = 'translateY(-20px)';
        setTimeout(() => {
          alertMessage.style.display = 'none';
        }, 500);
      }, 5000);
    }
  });
</script>

</body>
</html>